<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Platform v2.1</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 3px; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">
    <div id="app" class="min-h-screen flex flex-col">
        
        <!-- –≠–ö–†–ê–ù –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò -->
        <div v-if="!isAuthenticated" class="fixed inset-0 bg-gradient-to-br from-blue-900 to-blue-700 flex justify-center items-center z-50">
            <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md mx-4">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-700 rounded-2xl flex items-center justify-center text-white text-2xl font-bold mx-auto shadow-lg mb-3">HR</div>
                    <h1 class="text-2xl font-bold text-gray-800">HR Platform</h1>
                    <p class="text-gray-500 text-sm">{{ authMode === 'login' ? '–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É' : '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–ø–∞–Ω–∏–∏' }}</p>
                </div>
                <div v-if="authError" class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4 text-sm">{{ authError }}</div>
                
                <div v-if="authMode === 'login'" class="space-y-4">
                    <input v-model="authForm.email" type="email" class="w-full px-4 py-3 border rounded-lg outline-none focus:ring-2 focus:ring-blue-500" placeholder="Email">
                    <input v-model="authForm.password" type="password" class="w-full px-4 py-3 border rounded-lg outline-none focus:ring-2 focus:ring-blue-500" placeholder="–ü–∞—Ä–æ–ª—å" @keyup.enter="login">
                    <button @click="login" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-medium transition">–í–æ–π—Ç–∏</button>
                    <p class="text-center text-sm text-gray-500">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a @click="authMode = 'register'" class="text-blue-600 hover:underline cursor-pointer">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a></p>
                </div>

                <div v-if="authMode === 'register'" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <input v-model="authForm.first_name" type="text" class="w-full px-4 py-3 border rounded-lg outline-none focus:ring-2 focus:ring-blue-500" placeholder="–ò–º—è">
                        <input v-model="authForm.last_name" type="text" class="w-full px-4 py-3 border rounded-lg outline-none focus:ring-2 focus:ring-blue-500" placeholder="–§–∞–º–∏–ª–∏—è">
                    </div>
                    <input v-model="authForm.company_name" type="text" class="w-full px-4 py-3 border rounded-lg outline-none focus:ring-2 focus:ring-blue-500" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏">
                    <input v-model="authForm.email" type="email" class="w-full px-4 py-3 border rounded-lg outline-none focus:ring-2 focus:ring-blue-500" placeholder="Email">
                    <input v-model="authForm.password" type="password" class="w-full px-4 py-3 border rounded-lg outline-none focus:ring-2 focus:ring-blue-500" placeholder="–ü–∞—Ä–æ–ª—å">
                    <button @click="register" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 font-medium transition">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                    <p class="text-center text-sm text-gray-500">–ï—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a @click="authMode = 'login'" class="text-blue-600 hover:underline cursor-pointer">–í–æ–π—Ç–∏</a></p>
                </div>
            </div>
        </div>

        <!-- –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° -->
        <div v-else class="flex flex-col min-h-screen">
            <header class="bg-white shadow-sm sticky top-0 z-40">
                <div class="border-b">
                    <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-700 rounded-lg flex items-center justify-center text-white font-bold shadow-lg">HR</div>
                            <div>
                                <h1 class="text-xl font-bold text-gray-800 leading-tight">HR Platform</h1>
                                <p class="text-xs text-gray-500">{{ companyProfile.name || currentUser?.company_name }}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <div @click="currentTab = 'settings'; settingsSubTab = 'company'; loadSettings()" class="flex items-center gap-2 px-3 py-2 bg-gray-50 rounded-lg border cursor-pointer hover:bg-gray-100 transition">
                                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold">{{ currentUser?.first_name?.[0] || 'U' }}</div>
                                <div class="text-sm hidden md:block">
                                    <div class="font-medium text-gray-700">{{ currentUser?.first_name }} {{ currentUser?.last_name }}</div>
                                    <div class="text-xs text-gray-500">{{ currentUser?.role }}</div>
                                </div>
                            </div>
                            <button @click="logout" class="text-gray-400 hover:text-red-500 transition" title="–í—ã–π—Ç–∏"><i class="fas fa-sign-out-alt text-xl"></i></button>
                        </div>
                    </div>
                </div>
                <div class="max-w-7xl mx-auto px-4 overflow-x-auto">
                    <nav class="flex gap-6">
                        <button @click="currentTab = 'dashboard'; loadDashboard()" :class="['py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap', currentTab === 'dashboard' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700']"><i class="fas fa-chart-pie mr-2"></i>–î–∞—à–±–æ—Ä–¥</button>
                        <button @click="currentTab = 'vacancies'; fetchData()" :class="['py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap', currentTab === 'vacancies' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700']"><i class="fas fa-briefcase mr-2"></i>–í–∞–∫–∞–Ω—Å–∏–∏</button>
                        <button @click="currentTab = 'candidates'; loadCandidates()" :class="['py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap', currentTab === 'candidates' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700']"><i class="fas fa-users mr-2"></i>–ö–∞–Ω–¥–∏–¥–∞—Ç—ã</button>
                        <button @click="currentTab = 'settings'; loadSettings()" :class="['py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap', currentTab === 'settings' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700']"><i class="fas fa-cog mr-2"></i>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    </nav>
                </div>
            </header>

            <main class="flex-1 max-w-7xl mx-auto px-4 py-6 w-full">
                
                <!-- 1. –î–ê–®–ë–û–†–î -->
                <div v-if="currentTab === 'dashboard'" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-l-4 border-l-blue-500"><div class="text-gray-500 text-xs font-bold uppercase mb-1">–ê–∫—Ç–∏–≤–Ω—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏</div><div class="text-3xl font-bold text-gray-800">{{ dashboardData.active_vacancies }}</div></div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-l-4 border-l-yellow-500"><div class="text-gray-500 text-xs font-bold uppercase mb-1">–í —Ä–∞–±–æ—Ç–µ</div><div class="text-3xl font-bold text-gray-800">{{ dashboardData.candidates_in_work }}</div></div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-l-4 border-l-green-500"><div class="text-gray-500 text-xs font-bold uppercase mb-1">–ù–∞–Ω—è—Ç–æ</div><div class="text-3xl font-bold text-gray-800">{{ dashboardData.hired_this_month }}</div></div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-l-4 border-l-purple-500"><div class="text-gray-500 text-xs font-bold uppercase mb-1">–ö–æ–Ω–≤–µ—Ä—Å–∏—è</div><div class="text-3xl font-bold text-gray-800">{{ dashboardData.conversion_rate }}%</div></div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-sm border lg:col-span-2"><h3 class="font-bold text-gray-800 mb-4">üìä –í–æ—Ä–æ–Ω–∫–∞ –ø–æ–¥–±–æ—Ä–∞</h3><div class="h-64"><canvas id="dashboardChart"></canvas></div></div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border"><h3 class="font-bold text-gray-800 mb-4">üî• –¢—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è</h3><div v-if="dashboardData.urgent_candidates && dashboardData.urgent_candidates.length > 0" class="space-y-3"><div v-for="u in dashboardData.urgent_candidates" :key="u.id" class="p-3 bg-red-50 rounded-lg border border-red-100 flex justify-between items-center cursor-pointer hover:bg-red-100" @click="openCandidateCard(u.id)"><div><div class="font-bold text-sm text-gray-800">{{ u.name }}</div><div class="text-xs text-gray-500">{{ u.vacancy }}</div></div><div class="text-xs font-bold text-red-600 bg-white px-2 py-1 rounded">{{ u.days }} –¥–Ω.</div></div></div><div v-else class="text-center text-gray-400 py-10 text-sm">–ù–µ—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á üéâ</div></div>
                    </div>
                </div>

                <!-- 2. –í–ê–ö–ê–ù–°–ò–ò -->
                <div v-if="currentTab === 'vacancies'">
                    <div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-bold text-gray-800">–ê–∫—Ç–∏–≤–Ω—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏</h2><button @click="openCreateVacancyModal" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 shadow transition flex items-center"><i class="fas fa-plus mr-2"></i> –°–æ–∑–¥–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é</button></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div v-for="vac in vacancies" :key="vac.id" @click="openVacancy(vac.id)" class="bg-white p-5 rounded-xl shadow-sm border hover:shadow-md cursor-pointer transition group relative">
                            <div class="flex justify-between items-start mb-2"><h3 class="font-bold text-lg text-gray-800 group-hover:text-blue-600 transition">{{ vac.title }}</h3><span class="bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full font-medium">Active</span></div>
                            <p class="text-sm text-gray-500 line-clamp-2 mb-4">{{ vac.description }}</p>
                            <div class="flex justify-between items-center text-xs text-gray-400 border-t pt-3">
                                <span>ID: {{ vac.id }}</span>
                                <!-- –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
                                <button @click.stop="openEditVacancyModal(vac)" class="text-blue-500 hover:text-blue-700 font-medium z-10"><i class="fas fa-edit mr-1"></i>–†–µ–¥.</button>
                            </div>
                        </div>
                    </div>
                    <div v-if="vacancies.length === 0" class="text-center py-20 text-gray-400">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é!</div>
                </div>

                <!-- 3. –ö–ê–ù–î–ò–î–ê–¢–´ -->
                <div v-if="currentTab === 'candidates'">
                    <div class="bg-white p-4 rounded-lg shadow-sm border mb-6 flex flex-wrap gap-4"><div class="flex-1 min-w-[200px] relative"><input v-model="filters.search" @input="debouncedSearch" type="text" placeholder="–ü–æ–∏—Å–∫..." class="w-full pl-10 pr-4 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-blue-500"><span class="absolute left-3 top-2.5 text-gray-400"><i class="fas fa-search"></i></span></div><select v-model="filters.status" @change="loadCandidates" class="border rounded-lg px-3 py-2 bg-white"><option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option><option v-for="s in activeStatuses" :key="s.key" :value="s.key">{{ s.label }}</option></select><button @click="resetFilters" class="text-gray-500 hover:text-gray-700 px-2"><i class="fas fa-times mr-1"></i>–°–±—Ä–æ—Å</button></div>
                    <div class="bg-white rounded-lg shadow-sm border overflow-hidden"><table class="w-full text-left border-collapse"><thead class="bg-gray-50 border-b"><tr><th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase">–ö–∞–Ω–¥–∏–¥–∞—Ç</th><th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase">–í–∞–∫–∞–Ω—Å–∏—è</th><th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase text-center">Score</th><th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase text-center">–°—Ç–∞—Ç—É—Å</th><th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase text-right">–î–∞—Ç–∞</th></tr></thead><tbody class="divide-y divide-gray-200"><tr v-for="cand in candidatesList.items" :key="cand.id" @click="openCandidateCard(cand.id)" class="hover:bg-gray-50 cursor-pointer transition"><td class="px-6 py-4"><div class="font-medium text-gray-900">{{ cand.first_name }} {{ cand.last_name }}</div><div class="text-xs text-gray-500">{{ cand.email }}</div></td><td class="px-6 py-4 text-sm text-gray-600">{{ cand.vacancy_title }}</td><td class="px-6 py-4 text-center"><span class="inline-flex items-center justify-center px-2.5 py-0.5 rounded-full text-xs font-medium border" :class="getScoreBgColor(cand.ai_score)">{{ cand.ai_score }}%</span></td><td class="px-6 py-4 text-center"><span class="px-2 py-1 text-xs rounded-full" :class="getStatusClass(cand.status)">{{ getStatusLabel(cand.status) }}</span></td><td class="px-6 py-4 text-right text-sm text-gray-500">{{ new Date(cand.created_at).toLocaleDateString() }}</td></tr></tbody></table><div v-if="candidatesList.items && candidatesList.items.length === 0" class="text-center py-10 text-gray-400">–ö–∞–Ω–¥–∏–¥–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div></div>
                </div>

                <!-- 4. –ù–ê–°–¢–†–û–ô–ö–ò -->
                <div v-if="currentTab === 'settings'" class="space-y-6">
                    <div class="bg-white rounded-lg shadow-sm border">
                        <div class="border-b px-4 overflow-x-auto"><nav class="flex gap-4">
                            <button @click="settingsSubTab = 'company'" :class="['py-3 text-sm font-medium border-b-2 transition whitespace-nowrap', settingsSubTab === 'company' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500']">üè¢ –ö–æ–º–ø–∞–Ω–∏—è</button>
                            <button @click="settingsSubTab = 'users'; loadUsers()" :class="['py-3 text-sm font-medium border-b-2 transition whitespace-nowrap', settingsSubTab === 'users' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500']">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
                            <button @click="settingsSubTab = 'pipeline'; loadPipelineStages()" :class="['py-3 text-sm font-medium border-b-2 transition whitespace-nowrap', settingsSubTab === 'pipeline' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500']">üìä –í–æ—Ä–æ–Ω–∫–∞</button>
                            <button @click="settingsSubTab = 'templates'; loadEmailTemplates()" :class="['py-3 text-sm font-medium border-b-2 transition whitespace-nowrap', settingsSubTab === 'templates' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500']">‚úâÔ∏è –®–∞–±–ª–æ–Ω—ã –ø–∏—Å–µ–º</button>
                            <button @click="settingsSubTab = 'integrations'" :class="['py-3 text-sm font-medium border-b-2 transition whitespace-nowrap', settingsSubTab === 'integrations' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500']">üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</button>
                        </nav></div>
                        <div class="p-6">
                            <!-- –ü—Ä–æ—Ñ–∏–ª—å –∫–æ–º–ø–∞–Ω–∏–∏ -->
                            <div v-if="settingsSubTab === 'company'" class="max-w-2xl"><h2 class="text-xl font-bold mb-6">–ü—Ä–æ—Ñ–∏–ª—å –∫–æ–º–ø–∞–Ω–∏–∏</h2><div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ</label><input v-model="companyProfile.name" type="text" class="w-full border rounded-lg px-4 py-2"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">–û–ø–∏—Å–∞–Ω–∏–µ</label><textarea v-model="companyProfile.description" rows="3" class="w-full border rounded-lg px-4 py-2"></textarea></div><div class="grid grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">–°–∞–π—Ç</label><input v-model="companyProfile.website" type="url" class="w-full border rounded-lg px-4 py-2" placeholder="https://..."></div><div><label class="block text-sm font-medium text-gray-700 mb-1">Email</label><input v-model="companyProfile.contact_email" type="email" class="w-full border rounded-lg px-4 py-2"></div></div><button @click="saveCompanyProfile" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button></div></div>
                            <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
                            <div v-if="settingsSubTab === 'users'"><div class="flex justify-between items-center mb-6"><h2 class="text-xl font-bold">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2><button @click="showAddUserModal = true" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700"><i class="fas fa-plus mr-2"></i>–î–æ–±–∞–≤–∏—Ç—å</button></div><div class="bg-white border rounded-lg overflow-hidden"><table class="w-full"><thead class="bg-gray-50 border-b"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–†–æ–ª—å</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">–°—Ç–∞—Ç—É—Å</th><th class="px-6 py-3"></th></tr></thead><tbody class="divide-y"><tr v-for="user in companyUsers" :key="user.id" class="hover:bg-gray-50"><td class="px-6 py-4"><div class="font-medium">{{ user.first_name }} {{ user.last_name }}</div><div class="text-sm text-gray-500">{{ user.email }}</div></td><td class="px-6 py-4"><select v-model="user.role" @change="updateUserRole(user)" :disabled="user.id === currentUser.id" class="border rounded px-2 py-1 text-sm"><option value="admin">–ê–¥–º–∏–Ω</option><option value="recruiter">–†–µ–∫—Ä—É—Ç–µ—Ä</option><option value="hiring_manager">–ú–µ–Ω–µ–¥–∂–µ—Ä</option></select></td><td class="px-6 py-4"><span :class="user.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'" class="px-2 py-1 rounded-full text-xs">{{ user.is_active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–û—Ç–∫–ª—é—á–µ–Ω' }}</span></td><td class="px-6 py-4 text-right"><button v-if="user.id !== currentUser.id && user.is_active" @click="deactivateUser(user.id)" class="text-red-500 hover:text-red-700 text-sm">–£–¥–∞–ª–∏—Ç—å</button></td></tr></tbody></table></div></div>
                            <!-- –≠—Ç–∞–ø—ã –≤–æ—Ä–æ–Ω–∫–∏ -->
                            <div v-if="settingsSubTab === 'pipeline'"><div class="flex justify-between items-center mb-6"><div><h2 class="text-xl font-bold">–≠—Ç–∞–ø—ã –≤–æ—Ä–æ–Ω–∫–∏</h2><p class="text-sm text-gray-500 mt-1">–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞</p></div><button @click="showAddStageModal = true" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center"><i class="fas fa-plus mr-2"></i>–î–æ–±–∞–≤–∏—Ç—å —ç—Ç–∞–ø</button></div><div id="pipeline-stages-list" class="space-y-3 max-w-2xl"><div v-for="stage in pipelineStages" :key="stage.id" :data-stage-id="stage.id" class="flex items-center gap-4 p-4 bg-white border rounded-lg shadow-sm group hover:shadow-md transition"><span class="drag-handle cursor-move text-gray-400 hover:text-gray-600"><i class="fas fa-grip-vertical"></i></span><input type="color" v-model="stage.color" @change="updatePipelineStage(stage)" class="w-10 h-10 rounded cursor-pointer border-0 p-0"><input type="text" v-model="stage.label" @blur="updatePipelineStage(stage)" @keyup.enter="$event.target.blur()" class="flex-1 border-0 bg-transparent font-medium text-gray-800 focus:bg-gray-50 focus:ring-2 focus:ring-blue-500 rounded px-2 py-1"><span class="text-xs text-gray-400 font-mono bg-gray-100 px-2 py-1 rounded">{{ stage.key }}</span><span v-if="stage.is_final" class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded">–§–∏–Ω–∞–ª—å–Ω—ã–π</span><label v-if="!stage.is_final" class="flex items-center cursor-pointer"><div class="relative"><input type="checkbox" v-model="stage.is_active" @change="updatePipelineStage(stage)" class="sr-only"><div class="w-10 h-6 rounded-full transition-colors" :class="stage.is_active ? 'bg-green-500' : 'bg-gray-300'"></div><div class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full shadow transform transition-transform" :class="stage.is_active ? 'translate-x-4' : ''"></div></div></label><button v-if="!stage.is_final" @click="deletePipelineStage(stage)" class="text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition"><i class="fas fa-trash"></i></button></div></div><div class="mt-6 p-4 bg-blue-50 rounded-lg text-sm text-blue-800 max-w-2xl"><strong>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> –°–∫—Ä—ã—Ç—ã–µ —ç—Ç–∞–ø—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ Kanban. –§–∏–Ω–∞–ª—å–Ω—ã–µ —ç—Ç–∞–ø—ã –Ω–µ–ª—å–∑—è —Å–∫—Ä—ã—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å.</div></div>
                            <!-- –®–∞–±–ª–æ–Ω—ã –ø–∏—Å–µ–º -->
                            <div v-if="settingsSubTab === 'templates'"><div class="flex justify-between items-center mb-6"><div><h2 class="text-xl font-bold">–®–∞–±–ª–æ–Ω—ã –ø–∏—Å–µ–º</h2><p class="text-sm text-gray-500 mt-1">–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: <code class="bg-gray-100 px-1 rounded">{first_name}</code>, <code class="bg-gray-100 px-1 rounded">{vacancy_title}</code>, <code class="bg-gray-100 px-1 rounded">{company_name}</code></p></div><button @click="openCreateTemplateModal" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center"><i class="fas fa-plus mr-2"></i>–°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω</button></div><div class="grid gap-4 max-w-4xl"><div v-for="tpl in emailTemplates" :key="tpl.id" class="bg-white border rounded-lg p-5 hover:shadow-md transition"><div class="flex justify-between items-start mb-3"><div><h3 class="font-bold text-lg text-gray-800">{{ tpl.name }}</h3><p class="text-sm text-gray-500 mt-1">–¢–µ–º–∞: {{ tpl.subject }}</p></div><div class="flex items-center gap-2"><span :class="getTemplateTypeColor(tpl.type)" class="text-xs px-2 py-1 rounded-full font-medium">{{ getTemplateTypeLabel(tpl.type) }}</span></div></div><div class="bg-gray-50 p-3 rounded text-sm text-gray-600 max-h-24 overflow-hidden relative"><div class="whitespace-pre-wrap">{{ tpl.body.substring(0, 200) }}...</div></div><div class="flex justify-end gap-2 mt-4 pt-3 border-t"><button @click="openEditTemplateModal(tpl)" class="text-blue-600 hover:text-blue-800 text-sm font-medium"><i class="fas fa-edit mr-1"></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button><button @click="deleteEmailTemplate(tpl)" class="text-red-500 hover:text-red-700 text-sm font-medium"><i class="fas fa-trash mr-1"></i>–£–¥–∞–ª–∏—Ç—å</button></div></div><div v-if="emailTemplates.length === 0" class="text-center py-10 text-gray-400">–ù–µ—Ç —à–∞–±–ª–æ–Ω–æ–≤. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π!</div></div></div>
                            <!-- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ -->
                            <div v-if="settingsSubTab === 'integrations'"><h2 class="text-xl font-bold mb-6">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</h2><div class="grid gap-4 max-w-2xl"><div class="bg-white border rounded-lg p-4 flex justify-between items-center"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center text-red-600 font-bold">hh</div><div><h3 class="font-bold">HeadHunter (hh.ru)</h3><p class="text-sm text-gray-500">–ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤–∞–∫–∞–Ω—Å–∏–π</p></div></div><button class="bg-gray-100 text-gray-600 px-4 py-2 rounded-lg" disabled>–°–∫–æ—Ä–æ</button></div><div class="bg-white border rounded-lg p-4 flex justify-between items-center"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600"><i class="fab fa-telegram text-2xl"></i></div><div><h3 class="font-bold">Telegram Bot</h3><p class="text-sm text-gray-500">–ü—Ä–∏—ë–º —Ä–µ–∑—é–º–µ</p></div></div><span class="bg-green-100 text-green-800 px-3 py-1 rounded-lg text-sm">‚úì –ê–∫—Ç–∏–≤–µ–Ω</span></div></div></div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê -->
        
        <!-- –°–æ–∑–¥–∞–Ω–∏–µ/–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏ -->
        <div v-if="showModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 overflow-auto py-5">
            <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-2xl mx-4">
                <h2 class="text-xl font-bold mb-4">{{ isEditingVacancy ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é' : '–°–æ–∑–¥–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é' }}</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-bold mb-1">–î–æ–ª–∂–Ω–æ—Å—Ç—å *</label>
                        <input v-model="newVacancy.title" type="text" class="w-full border p-2 rounded" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Python Developer">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-1">–ì–æ—Ä–æ–¥</label>
                        <input v-model="newVacancy.city" type="text" class="w-full border p-2 rounded" placeholder="–ú–æ—Å–∫–≤–∞ / –£–¥–∞–ª–µ–Ω–Ω–æ">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-bold mb-1">–ó–∞—Ä–ø–ª–∞—Ç–∞ –æ—Ç</label>
                        <input v-model.number="newVacancy.salary_min" type="number" class="w-full border p-2 rounded" placeholder="100000">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-1">–ó–∞—Ä–ø–ª–∞—Ç–∞ –¥–æ</label>
                        <input v-model.number="newVacancy.salary_max" type="number" class="w-full border p-2 rounded" placeholder="200000">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-1">–û–ø—ã—Ç</label>
                        <select v-model="newVacancy.experience" class="w-full border p-2 rounded">
                            <option value="">–ù–µ –≤–∞–∂–Ω–æ</option>
                            <option value="no_exp">–ù–µ—Ç –æ–ø—ã—Ç–∞</option>
                            <option value="1-3">1-3 –≥–æ–¥–∞</option>
                            <option value="3-6">3-6 –ª–µ—Ç</option>
                            <option value="6+">–ë–æ–ª–µ–µ 6 –ª–µ—Ç</option>
                        </select>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-bold mb-1">–ö–ª—é—á–µ–≤—ã–µ –Ω–∞–≤—ã–∫–∏ *</label>
                    <textarea v-model="newVacancy.requirements" class="w-full border p-2 rounded" rows="3" placeholder="Python, SQL, Docker..."></textarea>
                </div>

                <div class="mb-4">
                    <div class="flex justify-between items-center mb-1">
                        <label class="block text-sm font-bold">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <button v-if="!isEditingVacancy" @click="generateDescription" :disabled="loading" class="text-xs text-blue-600 hover:underline">
                            ‚ú® –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å AI
                        </button>
                    </div>
                    <textarea v-model="newVacancy.description" class="w-full border p-2 rounded" rows="6" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏..."></textarea>
                </div>

                <div class="flex justify-end gap-2">
                    <button @click="showModal = false" class="text-gray-500 px-4 py-2 hover:bg-gray-100 rounded">–û—Ç–º–µ–Ω–∞</button>
                    <button @click="saveVacancy" :disabled="loading" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 flex items-center">
                        <span v-if="loading"><i class="fas fa-spinner fa-spin mr-2"></i>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...</span>
                        <span v-else>{{ isEditingVacancy ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' : '–°–æ–∑–¥–∞—Ç—å' }}</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div v-if="showAddUserModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50"><div class="bg-white p-6 rounded-lg shadow-xl w-96"><h2 class="text-xl font-bold mb-4">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2><div class="space-y-3"><input v-model="newUser.first_name" placeholder="–ò–º—è" class="w-full border p-2 rounded"><input v-model="newUser.last_name" placeholder="–§–∞–º–∏–ª–∏—è" class="w-full border p-2 rounded"><input v-model="newUser.email" placeholder="Email" class="w-full border p-2 rounded"><input v-model="newUser.password" placeholder="–ü–∞—Ä–æ–ª—å" type="password" class="w-full border p-2 rounded"><select v-model="newUser.role" class="w-full border p-2 rounded"><option value="recruiter">–†–µ–∫—Ä—É—Ç–µ—Ä</option><option value="admin">–ê–¥–º–∏–Ω</option></select></div><div class="flex justify-end gap-2 mt-4"><button @click="showAddUserModal = false" class="text-gray-500 px-4 py-2">–û—Ç–º–µ–Ω–∞</button><button @click="createUser" class="bg-green-600 text-white px-4 py-2 rounded">–î–æ–±–∞–≤–∏—Ç—å</button></div></div></div>

        <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —ç—Ç–∞–ø–∞ –≤–æ—Ä–æ–Ω–∫–∏ -->
        <div v-if="showAddStageModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50"><div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-md"><h2 class="text-xl font-bold mb-4">–î–æ–±–∞–≤–∏—Ç—å —ç—Ç–∞–ø –≤–æ—Ä–æ–Ω–∫–∏</h2><div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">–ö–ª—é—á (–ª–∞—Ç–∏–Ω–∏—Ü–∞)</label><input v-model="newStage.key" type="text" class="w-full border rounded-lg px-4 py-2" placeholder="technical_interview"><p class="text-xs text-gray-500 mt-1">–¢–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ _</p></div><div><label class="block text-sm font-medium text-gray-700 mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ</label><input v-model="newStage.label" type="text" class="w-full border rounded-lg px-4 py-2" placeholder="–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∏–Ω—Ç–µ—Ä–≤—å—é"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">–¶–≤–µ—Ç</label><div class="flex items-center gap-3"><input v-model="newStage.color" type="color" class="w-12 h-10 rounded cursor-pointer border p-1"><input v-model="newStage.color" type="text" class="flex-1 border rounded-lg px-4 py-2 font-mono"></div></div><div class="flex items-center gap-2"><input v-model="newStage.is_final" type="checkbox" id="is_final_cb" class="w-4 h-4"><label for="is_final_cb" class="text-sm text-gray-700">–§–∏–Ω–∞–ª—å–Ω—ã–π —ç—Ç–∞–ø</label></div></div><div class="flex justify-end gap-3 mt-6"><button @click="showAddStageModal = false" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">–û—Ç–º–µ–Ω–∞</button><button @click="createPipelineStage" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">–°–æ–∑–¥–∞—Ç—å</button></div></div></div>

        <!-- –†–µ–¥–∞–∫—Ç–æ—Ä —à–∞–±–ª–æ–Ω–∞ –ø–∏—Å—å–º–∞ -->
        <div v-if="showEmailTemplateModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 overflow-auto py-5"><div class="bg-white rounded-lg shadow-xl w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto"><div class="p-5 border-b sticky top-0 bg-white z-10"><div class="flex justify-between items-center"><h2 class="text-xl font-bold">{{ editingTemplate ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω' : '–ù–æ–≤—ã–π —à–∞–±–ª–æ–Ω' }}</h2><button @click="showEmailTemplateModal = false" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button></div></div><div class="grid grid-cols-1 lg:grid-cols-2 gap-6 p-5"><div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1">–¢–∏–ø</label><select v-model="templateForm.type" class="w-full border rounded-lg px-4 py-2"><option v-for="t in templateTypes" :key="t.value" :value="t.value">{{ t.label }}</option></select></div><div><label class="block text-sm font-medium text-gray-700 mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞</label><input v-model="templateForm.name" type="text" class="w-full border rounded-lg px-4 py-2"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">–¢–µ–º–∞ –ø–∏—Å—å–º–∞</label><input v-model="templateForm.subject" type="text" class="w-full border rounded-lg px-4 py-2"></div><div><label class="block text-sm font-medium text-gray-700 mb-1">–¢–µ–∫—Å—Ç –ø–∏—Å—å–º–∞</label><textarea v-model="templateForm.body" rows="10" class="w-full border rounded-lg px-4 py-2 font-mono text-sm"></textarea></div><div class="bg-blue-50 p-3 rounded-lg text-sm"><strong class="text-blue-800">–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:</strong><div class="flex flex-wrap gap-2 mt-2"><code @click="templateForm.body += '{first_name}'" class="bg-white px-2 py-1 rounded border text-blue-600 cursor-pointer hover:bg-blue-100">{first_name}</code><code @click="templateForm.body += '{last_name}'" class="bg-white px-2 py-1 rounded border text-blue-600 cursor-pointer hover:bg-blue-100">{last_name}</code><code @click="templateForm.body += '{vacancy_title}'" class="bg-white px-2 py-1 rounded border text-blue-600 cursor-pointer hover:bg-blue-100">{vacancy_title}</code><code @click="templateForm.body += '{company_name}'" class="bg-white px-2 py-1 rounded border text-blue-600 cursor-pointer hover:bg-blue-100">{company_name}</code></div></div></div><div class="bg-gray-50 rounded-lg p-5"><div class="flex justify-between items-center mb-4"><h3 class="font-bold text-gray-700">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h3><button @click="previewTemplate" class="text-blue-600 hover:text-blue-800 text-sm font-medium"><i class="fas fa-sync-alt mr-1"></i>–û–±–Ω–æ–≤–∏—Ç—å</button></div><div v-if="templatePreview" class="bg-white border rounded-lg overflow-hidden"><div class="bg-gray-100 p-3 border-b"><div class="text-xs text-gray-500">–ö–æ–º—É: ivan.petrov@example.com</div><div class="font-medium text-gray-800 mt-1">{{ templatePreview.subject }}</div></div><div class="p-4 text-sm text-gray-700 whitespace-pre-wrap">{{ templatePreview.body }}</div></div><div v-else class="text-center py-10 text-gray-400">–ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å"</div></div></div><div class="p-5 border-t bg-gray-50 flex justify-end gap-3"><button @click="showEmailTemplateModal = false" class="px-4 py-2 text-gray-600 hover:bg-gray-200 rounded-lg">–û—Ç–º–µ–Ω–∞</button><button @click="saveEmailTemplate" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">{{ editingTemplate ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' : '–°–æ–∑–¥–∞—Ç—å' }}</button></div></div></div>

        <!-- Kanban –í–∞–∫–∞–Ω—Å–∏–∏ -->
        <div v-if="showVacancyDetail" class="fixed inset-0 bg-black bg-opacity-50 z-50 overflow-auto flex justify-center items-start pt-5 pb-5"><div class="bg-white w-full max-w-[95%] h-[90vh] rounded-lg shadow-xl flex flex-col"><div class="p-4 border-b flex justify-between items-center bg-gray-50 rounded-t-lg"><div><h2 class="text-xl font-bold">{{ selectedVacancy.title }}</h2><p class="text-xs text-gray-500">–ö–∞–Ω–¥–∏–¥–∞—Ç–æ–≤: {{ selectedVacancy.candidates_count }}</p></div><button @click="closeVacancyDetail" class="text-gray-400 hover:text-gray-700 text-2xl">&times;</button></div><div class="flex-1 p-4 bg-gray-100 overflow-y-auto"><div class="grid grid-cols-1 md:grid-cols-3 xl:grid-cols-6 gap-4 h-full"><div v-for="status in activeStatuses" :key="status.key" class="flex flex-col bg-gray-200 rounded-lg p-2 h-full min-h-[300px]"><div class="flex justify-between items-center mb-2 px-2"><span class="font-bold text-gray-700 text-sm flex items-center truncate"><span class="w-3 h-3 rounded-full mr-2 flex-shrink-0" :style="{backgroundColor: status.color}"></span>{{ status.label }}</span><span class="bg-white text-xs px-2 py-0.5 rounded-full text-gray-500 shadow-sm">{{ vacancyCandidatesByStatus(status.key).length }}</span></div><div class="column-body flex-1 space-y-2 pr-1 overflow-y-auto custom-scrollbar" :data-status="status.key"><div v-for="cand in vacancyCandidatesByStatus(status.key)" :key="cand.id" :data-id="cand.id" @click.stop="openCandidateCard(cand.id)" class="bg-white p-3 rounded shadow-sm cursor-move hover:shadow-md border-l-4 transition relative group" :class="getScoreBorderColor(cand.ai_score)"><div class="flex justify-between items-start"><div class="font-bold text-sm text-gray-800 truncate pr-2">{{ cand.first_name }} {{ cand.last_name }}</div><div class="text-xs font-bold flex-shrink-0" :class="getTextColor(cand.ai_score)">{{ cand.ai_score }}%</div></div><div class="text-xs text-gray-500 mt-1 truncate">@{{ cand.telegram_id || '-' }}</div></div></div></div></div></div></div></div>

        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ö–∞–Ω–¥–∏–¥–∞—Ç–∞ -->
        <div v-if="showCandidateCard" class="fixed inset-0 bg-black bg-opacity-50 z-50 overflow-auto flex justify-center items-start pt-5 pb-5"><div class="bg-white w-full max-w-5xl rounded-lg shadow-xl min-h-[80vh] flex flex-col"><div class="p-6 border-b flex justify-between items-start bg-gray-50 rounded-t-lg"><div class="flex gap-5"><div class="w-20 h-20 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center text-white text-3xl font-bold shadow-md">{{ candidateDetail.first_name?.[0] || '?' }}</div><div><h2 class="text-3xl font-bold text-gray-800">{{ candidateDetail.first_name }} {{ candidateDetail.last_name }}</h2><p class="text-blue-600 font-medium mt-1">{{ candidateDetail.vacancy_title }}</p><div class="flex gap-2 mt-3"><span class="px-3 py-1 rounded-full text-sm font-medium" :class="getStatusClass(candidateDetail.status)">{{ getStatusLabel(candidateDetail.status) }}</span></div></div></div><button @click="closeCandidateCard" class="text-gray-400 hover:text-gray-700 text-3xl">&times;</button></div><div class="flex-1 grid grid-cols-1 lg:grid-cols-3"><div class="lg:col-span-2 p-6 border-r space-y-6"><div class="bg-blue-50 p-5 rounded-lg border border-blue-100"><h3 class="font-bold text-blue-800 mb-2">ü§ñ AI –ú–Ω–µ–Ω–∏–µ</h3><p class="text-gray-700">{{ candidateDetail.ai_summary }}</p></div><div><h3 class="font-bold text-gray-800 mb-3">üìÑ –†–µ–∑—é–º–µ</h3><div class="bg-gray-50 p-4 rounded-lg border text-sm text-gray-700 whitespace-pre-wrap font-mono max-h-96 overflow-y-auto">{{ candidateDetail.resume_text }}</div></div></div><div class="p-6 bg-gray-50 space-y-6"><div class="bg-white p-4 rounded-lg shadow-sm border"><h3 class="font-bold text-gray-800 mb-3">–î–µ–π—Å—Ç–≤–∏—è</h3><div class="flex flex-col gap-2"><button @click="changeStatusFromCard('interview')" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600 transition">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å</button><button @click="changeStatusFromCard('rejected')" class="w-full bg-red-100 text-red-600 py-2 rounded hover:bg-red-200 transition">–û—Ç–∫–∞–∑–∞—Ç—å</button></div></div><div class="bg-white p-4 rounded-lg shadow-sm border"><h3 class="font-bold text-gray-800 mb-3">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3><div class="space-y-3 mb-4 max-h-60 overflow-y-auto"><div v-for="comm in candidateDetail.comments" :key="comm.id" class="bg-gray-50 p-2 rounded text-sm"><div class="font-bold text-xs text-gray-500">{{ comm.author_name }}</div><p>{{ comm.text }}</p></div><div v-if="!candidateDetail.comments || candidateDetail.comments.length === 0" class="text-center text-gray-400 text-sm py-3">–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div></div><div class="flex gap-2"><input v-model="newComment" @keyup.enter="addComment" type="text" placeholder="–ó–∞–º–µ—Ç–∫–∞..." class="flex-1 border rounded px-2 py-1 text-sm"><button @click="addComment" class="bg-blue-600 text-white px-3 py-1 rounded text-sm">OK</button></div></div><div><h3 class="font-bold text-gray-500 text-xs uppercase mb-3">–ò—Å—Ç–æ—Ä–∏—è</h3><div class="space-y-4 border-l-2 border-gray-200 ml-2 pl-4"><div v-for="act in candidateDetail.activities" :key="act.id" class="relative"><div class="absolute -left-[21px] top-1 w-3 h-3 bg-gray-300 rounded-full border-2 border-white"></div><p class="text-sm text-gray-800">{{ act.description }}</p><p class="text-xs text-gray-400">{{ new Date(act.created_at).toLocaleString() }}</p></div></div></div></div></div></div></div>

    </div>

    <script>
        const { createApp } = Vue

        createApp({
            data() {
                return {
                    apiUrl: 'http://127.0.0.1:8000',
                    isAuthenticated: false, currentUser: null, authToken: null, authMode: 'login',
                    authForm: { email: '', password: '', first_name: '', last_name: '', company_name: '' }, authError: '',
                    currentTab: 'dashboard',
                    dashboardData: { active_vacancies: 0, candidates_in_work: 0, hired_this_month: 0, conversion_rate: 0, funnel_stats: {}, recent_activities: [], urgent_candidates: [] },
                    vacancies: [], candidatesList: { items: [], total: 0, page: 1, pages: 1 },
                    filters: { search: '', status: '', vacancy_id: '' },
                    settingsSubTab: 'company', companyProfile: {}, companyUsers: [],
                    showAddUserModal: false, newUser: { first_name: '', last_name: '', email: '', password: '', role: 'recruiter' },
                    pipelineStages: [], showAddStageModal: false, newStage: { key: '', label: '', color: '#3B82F6', is_final: false },
                    emailTemplates: [], showEmailTemplateModal: false, editingTemplate: null,
                    templateForm: { type: 'custom', name: '', subject: '', body: '' }, templatePreview: null,
                    templateTypes: [{ value: 'invitation', label: '–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ' }, { value: 'rejection', label: '–û—Ç–∫–∞–∑' }, { value: 'offer', label: '–û—Ñ—Ñ–µ—Ä' }, { value: 'custom', label: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π' }],
                    showModal: false, showVacancyDetail: false, showCandidateCard: false, loading: false,
                    
                    // –í–ê–ö–ê–ù–°–ò–ò (–ù–û–í–´–ï –ü–û–õ–Ø)
                    newVacancy: { title: '', requirements: '', description: '', salary_min: null, salary_max: null, experience: '', city: '' },
                    isEditingVacancy: false, // –§–ª–∞–≥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    editingVacancyId: null,
                    
                    selectedVacancy: {}, vacancyCandidates: [],
                    candidateDetail: { comments: [], activities: [] }, newComment: '',
                    defaultStatuses: [{ key: 'new', label: '–ù–æ–≤—ã–π', color: '#3B82F6' }, { key: 'screening', label: '–°–∫—Ä–∏–Ω–∏–Ω–≥', color: '#8B5CF6' }, { key: 'interview', label: '–ò–Ω—Ç–µ—Ä–≤—å—é', color: '#F59E0B' }, { key: 'offer', label: '–û—Ñ—Ñ–µ—Ä', color: '#F97316' }, { key: 'hired', label: '–ù–∞–Ω—è—Ç', color: '#10B981' }, { key: 'rejected', label: '–û—Ç–∫–∞–∑', color: '#EF4444' }],
                    dashboardChart: null, searchTimeout: null
                }
            },
            computed: {
                activeStatuses() { return this.pipelineStages.length > 0 ? this.pipelineStages.filter(s => s.is_active) : this.defaultStatuses; }
            },
            methods: {
                checkAuth() { const token = localStorage.getItem('hr_token'); const user = localStorage.getItem('hr_user'); if (token && user) { this.authToken = token; this.currentUser = JSON.parse(user); this.isAuthenticated = true; this.loadDashboard(); this.loadSettings(); } },
                async login() { this.authError = ''; try { const res = await fetch(`${this.apiUrl}/auth/login`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email: this.authForm.email, password: this.authForm.password }) }); if (!res.ok) throw new Error((await res.json()).detail); this.saveAuth(await res.json()); } catch (e) { this.authError = e.message; } },
                async register() { this.authError = ''; try { const res = await fetch(`${this.apiUrl}/auth/register`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(this.authForm) }); if (!res.ok) throw new Error((await res.json()).detail); this.saveAuth(await res.json()); } catch (e) { this.authError = e.message; } },
                saveAuth(data) { this.authToken = data.access_token; this.currentUser = data.user; this.isAuthenticated = true; localStorage.setItem('hr_token', data.access_token); localStorage.setItem('hr_user', JSON.stringify(data.user)); this.authForm = { email: '', password: '', first_name: '', last_name: '', company_name: '' }; this.loadDashboard(); this.loadSettings(); },
                logout() { this.isAuthenticated = false; this.authToken = null; this.currentUser = null; localStorage.removeItem('hr_token'); localStorage.removeItem('hr_user'); },
                async apiFetch(url, options = {}) { const headers = { 'Content-Type': 'application/json', ...(options.headers || {}) }; if (this.authToken) headers['Authorization'] = `Bearer ${this.authToken}`; const res = await fetch(url, { ...options, headers }); if (res.status === 401) { this.logout(); throw new Error('Unauthorized'); } return res; },
                async loadDashboard() { try { const res = await this.apiFetch(`${this.apiUrl}/dashboard/stats`); if (res.ok) { this.dashboardData = await res.json(); this.$nextTick(() => this.renderDashboardChart()); } } catch (e) { console.error(e); } },
                async fetchData() { try { const res = await this.apiFetch(`${this.apiUrl}/vacancies/`); if (res.ok) this.vacancies = await res.json(); } catch (e) { console.error(e); } },
                async loadCandidates() { try { const params = new URLSearchParams({ page: this.candidatesList.page, per_page: 10, search: this.filters.search, status: this.filters.status, vacancy_id: this.filters.vacancy_id }); if (!this.filters.search) params.delete('search'); if (!this.filters.status) params.delete('status'); if (!this.filters.vacancy_id) params.delete('vacancy_id'); const res = await this.apiFetch(`${this.apiUrl}/candidates/search?${params}`); if (res.ok) this.candidatesList = await res.json(); } catch (e) { console.error(e); } },
                debouncedSearch() { clearTimeout(this.searchTimeout); this.searchTimeout = setTimeout(() => this.loadCandidates(), 300); },
                resetFilters() { this.filters = { search: '', status: '', vacancy_id: '' }; this.loadCandidates(); },
                async loadSettings() { await this.loadCompanyProfile(); await this.loadPipelineStages(); },
                async loadCompanyProfile() { try { const res = await this.apiFetch(`${this.apiUrl}/settings/company`); if (res.ok) this.companyProfile = await res.json(); } catch (e) { console.error(e); } },
                async saveCompanyProfile() { try { await this.apiFetch(`${this.apiUrl}/settings/company`, { method: 'PATCH', body: JSON.stringify(this.companyProfile) }); alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!'); } catch (e) { alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è'); } },
                async loadUsers() { try { const res = await this.apiFetch(`${this.apiUrl}/settings/users`); if (res.ok) this.companyUsers = await res.json(); } catch (e) { console.error(e); } },
                async createUser() { try { const res = await this.apiFetch(`${this.apiUrl}/settings/users`, { method: 'POST', body: JSON.stringify(this.newUser) }); if (res.ok) { this.showAddUserModal = false; this.newUser = { first_name: '', last_name: '', email: '', password: '', role: 'recruiter' }; await this.loadUsers(); } else { const err = await res.json(); alert(err.detail || '–û—à–∏–±–∫–∞'); } } catch (e) { alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'); } },
                async updateUserRole(user) { try { await this.apiFetch(`${this.apiUrl}/settings/users/${user.id}/role`, { method: 'PATCH', body: JSON.stringify({ role: user.role }) }); } catch (e) { console.error(e); } },
                async deactivateUser(userId) { if (!confirm('–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) return; try { await this.apiFetch(`${this.apiUrl}/settings/users/${userId}`, { method: 'DELETE' }); await this.loadUsers(); } catch (e) { alert('–û—à–∏–±–∫–∞'); } },
                async loadPipelineStages() { try { const res = await this.apiFetch(`${this.apiUrl}/settings/pipeline`); if (res.ok) { this.pipelineStages = await res.json(); this.$nextTick(() => this.initPipelineSortable()); } } catch (e) { console.error(e); } },
                async createPipelineStage() { if (!this.newStage.key || !this.newStage.label) { alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∫–ª—é—á –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ'); return; } if (!/^[a-z][a-z0-9_]*$/.test(this.newStage.key)) { alert('–ö–ª—é—á: —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω–∏—Ü–∞, —Ü–∏—Ñ—Ä—ã –∏ _'); return; } try { const res = await this.apiFetch(`${this.apiUrl}/settings/pipeline`, { method: 'POST', body: JSON.stringify(this.newStage) }); if (res.ok) { this.showAddStageModal = false; this.newStage = { key: '', label: '', color: '#3B82F6', is_final: false }; await this.loadPipelineStages(); } else { const err = await res.json(); alert(err.detail || '–û—à–∏–±–∫–∞'); } } catch (e) { alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'); } },
                async updatePipelineStage(stage) { try { await this.apiFetch(`${this.apiUrl}/settings/pipeline/${stage.id}`, { method: 'PATCH', body: JSON.stringify({ label: stage.label, color: stage.color, is_active: stage.is_active }) }); } catch (e) { console.error(e); } },
                async deletePipelineStage(stage) { if (stage.is_final) { alert('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —ç—Ç–∞–ø'); return; } if (!confirm(`–£–¥–∞–ª–∏—Ç—å —ç—Ç–∞–ø "${stage.label}"?`)) return; try { const res = await this.apiFetch(`${this.apiUrl}/settings/pipeline/${stage.id}`, { method: 'DELETE' }); if (res.ok) { await this.loadPipelineStages(); } else { const err = await res.json(); alert(err.detail || '–û—à–∏–±–∫–∞'); } } catch (e) { alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'); } },
                async savePipelineOrder() { const stageIds = this.pipelineStages.map(s => s.id); try { await this.apiFetch(`${this.apiUrl}/settings/pipeline/reorder`, { method: 'POST', body: JSON.stringify({ stage_ids: stageIds }) }); } catch (e) { console.error(e); } },
                initPipelineSortable() { const container = document.getElementById('pipeline-stages-list'); if (!container || container._sortable) return; container._sortable = new Sortable(container, { animation: 150, handle: '.drag-handle', ghostClass: 'opacity-50', onEnd: () => { const items = container.querySelectorAll('[data-stage-id]'); const newOrder = []; items.forEach(item => { const id = parseInt(item.dataset.stageId); const stage = this.pipelineStages.find(s => s.id === id); if (stage) newOrder.push(stage); }); this.pipelineStages = newOrder; this.savePipelineOrder(); } }); },
                async loadEmailTemplates() { try { const res = await this.apiFetch(`${this.apiUrl}/settings/email-templates`); if (res.ok) this.emailTemplates = await res.json(); } catch (e) { console.error(e); } },
                openCreateTemplateModal() { this.editingTemplate = null; this.templateForm = { type: 'custom', name: '', subject: '', body: '' }; this.templatePreview = null; this.showEmailTemplateModal = true; },
                openEditTemplateModal(template) { this.editingTemplate = template; this.templateForm = { type: template.type, name: template.name, subject: template.subject, body: template.body }; this.templatePreview = null; this.showEmailTemplateModal = true; },
                async saveEmailTemplate() { if (!this.templateForm.name || !this.templateForm.subject || !this.templateForm.body) { alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'); return; } try { let res; if (this.editingTemplate) { res = await this.apiFetch(`${this.apiUrl}/settings/email-templates/${this.editingTemplate.id}`, { method: 'PATCH', body: JSON.stringify(this.templateForm) }); } else { res = await this.apiFetch(`${this.apiUrl}/settings/email-templates`, { method: 'POST', body: JSON.stringify(this.templateForm) }); } if (res.ok) { this.showEmailTemplateModal = false; await this.loadEmailTemplates(); } else { const err = await res.json(); alert(err.detail || '–û—à–∏–±–∫–∞'); } } catch (e) { alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'); } },
                async deleteEmailTemplate(template) { if (!confirm(`–£–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω "${template.name}"?`)) return; try { const res = await this.apiFetch(`${this.apiUrl}/settings/email-templates/${template.id}`, { method: 'DELETE' }); if (res.ok) await this.loadEmailTemplates(); else alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è'); } catch (e) { alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'); } },
                previewTemplate() { const companyName = this.companyProfile.name || '–ö–æ–º–ø–∞–Ω–∏—è'; this.templatePreview = { subject: this.templateForm.subject.replace('{first_name}', '–ò–≤–∞–Ω').replace('{last_name}', '–ü–µ—Ç—Ä–æ–≤').replace('{vacancy_title}', 'Python Developer').replace('{company_name}', companyName), body: this.templateForm.body.replace('{first_name}', '–ò–≤–∞–Ω').replace('{last_name}', '–ü–µ—Ç—Ä–æ–≤').replace('{vacancy_title}', 'Python Developer').replace('{company_name}', companyName) }; },
                getTemplateTypeLabel(type) { const found = this.templateTypes.find(t => t.value === type); return found ? found.label : type; },
                getTemplateTypeColor(type) { const colors = { 'invitation': 'bg-green-100 text-green-800', 'rejection': 'bg-red-100 text-red-800', 'offer': 'bg-yellow-100 text-yellow-800', 'custom': 'bg-gray-100 text-gray-800' }; return colors[type] || 'bg-gray-100 text-gray-800'; },
                
                // --- VACANCY ACTIONS (NEW) ---
                openCreateVacancyModal() {
                    this.isEditingVacancy = false;
                    this.newVacancy = { title: '', requirements: '', description: '', salary_min: null, salary_max: null, experience: '', city: '' };
                    this.showModal = true;
                },
                openEditVacancyModal(vac) {
                    this.isEditingVacancy = true;
                    this.editingVacancyId = vac.id;
                    this.newVacancy = { ...vac }; // –ö–æ–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
                    this.showModal = true;
                },
                async generateDescription() {
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
                    if (!this.newVacancy.title || !this.newVacancy.requirements) { 
                        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ "–î–æ–ª–∂–Ω–æ—Å—Ç—å" –∏ "–ö–ª—é—á–µ–≤—ã–µ –Ω–∞–≤—ã–∫–∏", —á—Ç–æ–±—ã AI –∑–Ω–∞–ª, –æ —á–µ–º –ø–∏—Å–∞—Ç—å.'); 
                        return; 
                    }
                    
                    this.loading = true;
                    try {
                        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é (–±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è)
                        const res = await this.apiFetch(`${this.apiUrl}/vacancies/preview_ai`, {
                            method: 'POST',
                            body: JSON.stringify(this.newVacancy)
                        });
                        
                        if (res.ok) {
                            const data = await res.json();
                            // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª–µ –æ–ø–∏—Å–∞–Ω–∏—è
                            this.newVacancy.description = data.description;
                        } else {
                            alert("–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å.");
                        }
                    } catch (e) { 
                        console.error(e); 
                        alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏"); 
                    } finally { 
                        this.loading = false; 
                    }
                },
                async saveVacancy() {
                    this.loading = true;
                    try {
                        // 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–µ–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ null)
                        const payload = { ...this.newVacancy };
                        if (payload.salary_min === "" || payload.salary_min === 0) payload.salary_min = null;
                        if (payload.salary_max === "" || payload.salary_max === 0) payload.salary_max = null;
                        if (payload.city === "") payload.city = null;
                        if (payload.experience === "") payload.experience = null;

                        if (this.isEditingVacancy) {
                            // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (PATCH)
                            await this.apiFetch(`${this.apiUrl}/vacancies/${this.editingVacancyId}`, {
                                method: 'PATCH',
                                body: JSON.stringify(payload)
                            });
                        } else {
                            // –°–æ–∑–¥–∞–Ω–∏–µ (POST)
                            // –ï—Å–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—É—Å—Ç–æ–µ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é, –∏–Ω–∞—á–µ –æ–±—ã—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ
                            const endpoint = payload.description ? `${this.apiUrl}/vacancies/` : `${this.apiUrl}/vacancies/generate`;
                            await this.apiFetch(endpoint, {
                                method: 'POST',
                                body: JSON.stringify(payload)
                            });
                        }
                        this.showModal = false;
                        this.fetchData();
                    } catch (e) { 
                        console.error(e); 
                        alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: " + e.message); 
                    }
                    finally { this.loading = false; }
                },

                async openVacancy(vacancyId) { try { const res = await this.apiFetch(`${this.apiUrl}/vacancies/${vacancyId}`); if (res.ok) { this.selectedVacancy = await res.json(); const candRes = await this.apiFetch(`${this.apiUrl}/vacancies/${vacancyId}/candidates`); if (candRes.ok) this.vacancyCandidates = await candRes.json(); this.showVacancyDetail = true; this.$nextTick(() => this.initKanbanSortable()); } } catch (e) { console.error(e); } },
                closeVacancyDetail() { this.showVacancyDetail = false; },
                vacancyCandidatesByStatus(status) { return this.vacancyCandidates.filter(c => c.status === status); },
                async openCandidateCard(candidateId) { try { const res = await this.apiFetch(`${this.apiUrl}/candidates/${candidateId}/detail`); if (res.ok) { this.candidateDetail = await res.json(); this.showCandidateCard = true; } } catch (e) { console.error(e); } },
                closeCandidateCard() { this.showCandidateCard = false; },
                async changeStatusFromCard(newStatus) { try { await this.apiFetch(`${this.apiUrl}/candidates/${this.candidateDetail.id}`, { method: 'PATCH', body: JSON.stringify({ status: newStatus }) }); this.candidateDetail.status = newStatus; const idx = this.vacancyCandidates.findIndex(c => c.id === this.candidateDetail.id); if (idx !== -1) this.vacancyCandidates[idx].status = newStatus; } catch (e) { console.error(e); } },
                async addComment() { if (!this.newComment.trim()) return; try { const res = await this.apiFetch(`${this.apiUrl}/candidates/${this.candidateDetail.id}/comments`, { method: 'POST', body: JSON.stringify({ text: this.newComment }) }); if (res.ok) { const comment = await res.json(); this.candidateDetail.comments = this.candidateDetail.comments || []; this.candidateDetail.comments.push(comment); this.newComment = ''; } } catch (e) { console.error(e); } },
                getStatusLabel(key) { const stage = this.activeStatuses.find(s => s.key === key); return stage ? stage.label : key; },
                getStatusClass(status) { const classes = { 'new': 'bg-blue-100 text-blue-800', 'screening': 'bg-purple-100 text-purple-800', 'interview': 'bg-yellow-100 text-yellow-800', 'offer': 'bg-orange-100 text-orange-800', 'hired': 'bg-green-100 text-green-800', 'rejected': 'bg-red-100 text-red-800' }; return classes[status] || 'bg-gray-100 text-gray-800'; },
                getScoreBgColor(score) { if (score >= 80) return 'bg-green-100 text-green-800 border-green-300'; if (score >= 60) return 'bg-yellow-100 text-yellow-800 border-yellow-300'; return 'bg-red-100 text-red-800 border-red-300'; },
                getScoreBorderColor(score) { if (score >= 80) return 'border-l-green-500'; if (score >= 60) return 'border-l-yellow-500'; return 'border-l-red-500'; },
                getTextColor(score) { if (score >= 80) return 'text-green-600'; if (score >= 60) return 'text-yellow-600'; return 'text-red-600'; },
                renderDashboardChart() { const canvas = document.getElementById('dashboardChart'); if (!canvas) return; if (this.dashboardChart) this.dashboardChart.destroy(); const stats = this.dashboardData.funnel_stats || {}; const labels = this.activeStatuses.map(s => s.label); const data = this.activeStatuses.map(s => stats[s.key] || 0); const colors = this.activeStatuses.map(s => s.color); this.dashboardChart = new Chart(canvas, { type: 'bar', data: { labels, datasets: [{ label: '–ö–∞–Ω–¥–∏–¥–∞—Ç—ã', data, backgroundColor: colors }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } } }); },
                initKanbanSortable() { document.querySelectorAll('.column-body').forEach(col => { if (col._sortable) return; col._sortable = new Sortable(col, { group: 'kanban', animation: 150, ghostClass: 'opacity-50', onEnd: async (evt) => { const candidateId = parseInt(evt.item.dataset.id); const newStatus = evt.to.dataset.status; try { await this.apiFetch(`${this.apiUrl}/candidates/${candidateId}`, { method: 'PATCH', body: JSON.stringify({ status: newStatus }) }); const cand = this.vacancyCandidates.find(c => c.id === candidateId); if (cand) cand.status = newStatus; } catch (e) { console.error(e); } } }); }); }
            },
            mounted() { this.checkAuth(); }
        }).mount('#app')
    </script>
</body>
</html>