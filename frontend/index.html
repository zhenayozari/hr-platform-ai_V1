<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Platform v2.0</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-100 text-gray-800 font-sans">
    <div id="app" class="min-h-screen flex flex-col">
        
        <!-- ========== –®–ê–ü–ö–ê –° –ù–ê–í–ò–ì–ê–¶–ò–ï–ô ========== -->
        <header class="bg-white shadow-sm sticky top-0 z-40">
            <div class="border-b">
                <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-700 rounded-lg flex items-center justify-center text-white font-bold shadow-lg">
                            HR
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-800 leading-tight">HR Platform</h1>
                            <p class="text-xs text-gray-500">v2.0 Enterprise</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="flex items-center gap-2 px-3 py-2 bg-gray-50 rounded-lg border">
                            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold">
                                A
                            </div>
                            <div class="text-sm hidden md:block">
                                <div class="font-medium text-gray-700">Admin User</div>
                                <div class="text-xs text-gray-500">–†–µ–∫—Ä—É—Ç–µ—Ä</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∏ -->
            <div class="max-w-7xl mx-auto px-4 overflow-x-auto">
                <nav class="flex gap-6">
                    <button @click="currentTab = 'dashboard'" :class="['py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap', currentTab === 'dashboard' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700']">
                        <i class="fas fa-chart-pie mr-2"></i>–î–∞—à–±–æ—Ä–¥
                    </button>
                    <button @click="currentTab = 'vacancies'; fetchData()" :class="['py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap', currentTab === 'vacancies' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700']">
                        <i class="fas fa-briefcase mr-2"></i>–í–∞–∫–∞–Ω—Å–∏–∏
                    </button>
                    <button @click="currentTab = 'candidates'; loadCandidates(); loadCandidatesStats()" :class="['py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap', currentTab === 'candidates' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700']">
                        <i class="fas fa-users mr-2"></i>–ö–∞–Ω–¥–∏–¥–∞—Ç—ã
                    </button>
                    <button @click="currentTab = 'settings'" :class="['py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap', currentTab === 'settings' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700']">
                        <i class="fas fa-cog mr-2"></i>–ù–∞—Å—Ç—Ä–æ–π–∫–∏
                    </button>
                </nav>
            </div>
        </header>

        <!-- ========== –ö–û–ù–¢–ï–ù–¢ ========== -->
        <main class="flex-1 max-w-7xl mx-auto px-4 py-6 w-full">
            
            <!-- 1. –î–ê–®–ë–û–†–î -->
            <div v-if="currentTab === 'dashboard'" class="space-y-6">
                <div class="bg-white p-6 rounded-lg shadow-sm border">
                    <h2 class="text-xl font-bold mb-4">üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
                    <p class="text-gray-600">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∫–ª–∞–¥–∫—É "–í–∞–∫–∞–Ω—Å–∏–∏" –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–æ—Ä–æ–Ω–∫–æ–π –∏–ª–∏ "–ö–∞–Ω–¥–∏–¥–∞—Ç—ã" –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –±–∞–∑–µ.</p>
                </div>
            </div>

            <!-- 2. –í–ê–ö–ê–ù–°–ò–ò -->
            <div v-if="currentTab === 'vacancies'">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">–ê–∫—Ç–∏–≤–Ω—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏</h2>
                    <button @click="showModal = true" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 shadow transition flex items-center">
                        <i class="fas fa-plus mr-2"></i> –°–æ–∑–¥–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div v-for="vac in vacancies" :key="vac.id" @click="openVacancy(vac.id)" class="bg-white p-5 rounded-xl shadow-sm border hover:shadow-md cursor-pointer transition group">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-bold text-lg text-gray-800 group-hover:text-blue-600 transition">{{ vac.title }}</h3>
                            <span class="bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full font-medium">Active</span>
                        </div>
                        <p class="text-sm text-gray-500 line-clamp-2 mb-4">{{ vac.description }}</p>
                        <div class="flex justify-between items-center text-xs text-gray-400 border-t pt-3">
                            <span>ID: {{ vac.id }}</span>
                            <span>–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π ‚Üí</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 3. –ö–ê–ù–î–ò–î–ê–¢–´ -->
            <div v-if="currentTab === 'candidates'">
                
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–≤–µ—Ä—Ö—É -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-white p-4 rounded-lg shadow-sm border flex items-center justify-between">
                        <div>
                            <div class="text-gray-500 text-xs uppercase font-bold">–í—Å–µ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤</div>
                            <div class="text-2xl font-bold text-gray-800">{{ candidatesStats.total }}</div>
                        </div>
                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border flex items-center justify-between">
                        <div>
                            <div class="text-gray-500 text-xs uppercase font-bold">–°—Ä–µ–¥–Ω–∏–π Score</div>
                            <div class="text-2xl font-bold text-purple-600">{{ candidatesStats.avg_score }}%</div>
                        </div>
                        <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center text-purple-600">
                            <i class="fas fa-brain"></i>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border flex items-center justify-between">
                        <div>
                            <div class="text-gray-500 text-xs uppercase font-bold">–≠–∫—Å–ø–æ—Ä—Ç</div>
                            <button @click="exportCandidates" class="text-sm text-blue-600 hover:underline">–°–∫–∞—á–∞—Ç—å CSV</button>
                        </div>
                        <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center text-green-600">
                            <i class="fas fa-file-excel"></i>
                        </div>
                    </div>
                </div>

                <!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
                <div class="bg-white p-4 rounded-lg shadow-sm border mb-6">
                    <div class="flex flex-wrap gap-4">
                        <!-- –ü–æ–∏—Å–∫ -->
                        <div class="flex-1 min-w-[200px]">
                            <div class="relative">
                                <input v-model="filters.search" @input="debouncedSearch" type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, email..." class="w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                                <span class="absolute left-3 top-2.5 text-gray-400"><i class="fas fa-search"></i></span>
                            </div>
                        </div>
                        <!-- –§–∏–ª—å—Ç—Ä—ã -->
                        <select v-model="filters.status" @change="loadCandidates" class="border rounded-lg px-3 py-2 bg-white">
                            <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                            <option v-for="s in statuses" :key="s.key" :value="s.key">{{ s.label }}</option>
                        </select>
                        <select v-model="filters.vacancy_id" @change="loadCandidates" class="border rounded-lg px-3 py-2 bg-white max-w-[200px]">
                            <option value="">–í—Å–µ –≤–∞–∫–∞–Ω—Å–∏–∏</option>
                            <option v-for="v in vacancies" :key="v.id" :value="v.id">{{ v.title }}</option>
                        </select>
                        <button @click="resetFilters" class="text-gray-500 hover:text-gray-700 px-2">
                            <i class="fas fa-times"></i> –°–±—Ä–æ—Å
                        </button>
                    </div>
                </div>

                <!-- –¢–∞–±–ª–∏—Ü–∞ -->
                <div class="bg-white rounded-lg shadow-sm border overflow-hidden">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-gray-50 border-b">
                            <tr>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase">–ö–∞–Ω–¥–∏–¥–∞—Ç</th>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase">–í–∞–∫–∞–Ω—Å–∏—è</th>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase text-center">AI Score</th>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase text-center">–°—Ç–∞—Ç—É—Å</th>
                                <th class="px-6 py-3 text-xs font-medium text-gray-500 uppercase text-right">–î–∞—Ç–∞</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            <!-- –û–ë–ù–û–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω @click –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ -->
                            <tr v-for="cand in candidatesList.items" :key="cand.id" @click="openCandidateCard(cand.id)" class="hover:bg-gray-50 cursor-pointer transition">
                                <td class="px-6 py-4">
                                    <div class="flex items-center">
                                        <div class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold mr-3">
                                            {{ cand.first_name[0] }}
                                        </div>
                                        <div>
                                            <div class="font-medium text-gray-900">{{ cand.first_name }} {{ cand.last_name }}</div>
                                            <div class="text-xs text-gray-500">{{ cand.email }}</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-600">
                                    {{ cand.vacancy_title }}
                                </td>
                                <td class="px-6 py-4 text-center">
                                    <span class="inline-flex items-center justify-center px-2.5 py-0.5 rounded-full text-xs font-medium border"
                                          :class="getScoreBgColor(cand.ai_score)">
                                        {{ cand.ai_score }}%
                                    </span>
                                </td>
                                <td class="px-6 py-4 text-center">
                                    <span class="px-2 py-1 text-xs rounded-full" :class="getStatusClass(cand.status)">
                                        {{ getStatusLabel(cand.status) }}
                                    </span>
                                </td>
                                <td class="px-6 py-4 text-right text-sm text-gray-500">
                                    {{ new Date(cand.created_at).toLocaleDateString() }}
                                </td>
                            </tr>
                            <!-- –ï—Å–ª–∏ –ø—É—Å—Ç–æ -->
                            <tr v-if="candidatesList.items.length === 0">
                                <td colspan="5" class="px-6 py-10 text-center text-gray-500">
                                    –ö–∞–Ω–¥–∏–¥–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
                    <div class="bg-gray-50 px-6 py-3 border-t flex justify-between items-center">
                        <span class="text-sm text-gray-500">
                            –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ candidatesList.page }} –∏–∑ {{ candidatesList.pages }}
                        </span>
                        <div class="flex gap-2">
                            <button @click="goToPage(candidatesList.page - 1)" :disabled="candidatesList.page <= 1" class="px-3 py-1 border rounded bg-white hover:bg-gray-50 disabled:opacity-50">–ù–∞–∑–∞–¥</button>
                            <button @click="goToPage(candidatesList.page + 1)" :disabled="candidatesList.page >= candidatesList.pages" class="px-3 py-1 border rounded bg-white hover:bg-gray-50 disabled:opacity-50">–í–ø–µ—Ä–µ–¥</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4. –ù–ê–°–¢–†–û–ô–ö–ò -->
            <div v-if="currentTab === 'settings'">
                <div class="bg-white p-6 rounded-lg shadow-sm border">
                    <h2 class="text-xl font-bold mb-4">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h2>
                    <p class="text-gray-600">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram –∏ hh.ru –±—É–¥—É—Ç –∑–¥–µ—Å—å.</p>
                </div>
            </div>

        </main>

        <!-- ========== –ú–û–î–ê–õ–ö–ò ========== -->
        
        <!-- 1. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏ -->
        <div v-if="showModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
            <div class="bg-white p-6 rounded-lg shadow-xl w-96">
                <h2 class="text-xl font-bold mb-4">‚ú® –°–æ–∑–¥–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é (AI)</h2>
                <div class="mb-4">
                    <label class="block text-sm font-bold mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏</label>
                    <input v-model="newVacancy.title" type="text" class="w-full border p-2 rounded" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Senior Python Dev">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-bold mb-1">–ö–ª—é—á–µ–≤—ã–µ –Ω–∞–≤—ã–∫–∏</label>
                    <textarea v-model="newVacancy.requirements" class="w-full border p-2 rounded" placeholder="Python, FastAPI, Docker..."></textarea>
                </div>
                <div class="flex justify-end gap-2">
                    <button @click="showModal = false" class="text-gray-500 px-4 py-2 hover:bg-gray-100 rounded">–û—Ç–º–µ–Ω–∞</button>
                    <button @click="createVacancy" :disabled="loading" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 flex items-center">
                        <span v-if="loading"><i class="fas fa-spinner fa-spin mr-2"></i> AI –¥—É–º–∞–µ—Ç...</span>
                        <span v-else>–°–æ–∑–¥–∞—Ç—å</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 2. –î–µ—Ç–∞–ª–∏ –≤–∞–∫–∞–Ω—Å–∏–∏ + –ö–ê–ù–ë–ê–ù -->
        <div v-if="showVacancyDetail" class="fixed inset-0 bg-black bg-opacity-50 z-50 overflow-auto flex justify-center items-start pt-5 pb-5">
            <div class="bg-white w-full max-w-[95%] h-[90vh] rounded-lg shadow-xl flex flex-col">
                <!-- –®–∞–ø–∫–∞ -->
                <div class="p-4 border-b flex justify-between items-center bg-gray-50 rounded-t-lg">
                    <div>
                        <h2 class="text-xl font-bold">{{ selectedVacancy.title }}</h2>
                        <p class="text-xs text-gray-500">–ö–∞–Ω–¥–∏–¥–∞—Ç–æ–≤: {{ selectedVacancy.candidates_count }}</p>
                    </div>
                    <button @click="closeVacancyDetail" class="text-gray-400 hover:text-gray-700 text-2xl">&times;</button>
                </div>
                
                <!-- –ö–∞–Ω–±–∞–Ω (–°–∫—Ä–æ–ª–ª–∏—Ä—É–µ–º–∞—è –æ–±–ª–∞—Å—Ç—å) -->
                <div class="flex-1 overflow-x-auto p-4 bg-gray-100">
                    <div class="flex gap-4 h-full min-w-max">
                        <div v-for="status in statuses" :key="status.key" class="flex flex-col w-80 bg-gray-200 rounded-lg p-2 h-full">
                            <div class="flex justify-between items-center mb-2 px-2">
                                <span class="font-bold text-gray-700 text-sm flex items-center">
                                    <span class="w-2 h-2 rounded-full mr-2" :class="status.color"></span>
                                    {{ status.label }}
                                </span>
                                <span class="bg-white text-xs px-2 py-0.5 rounded-full text-gray-500 shadow-sm">
                                    {{ vacancyCandidatesByStatus(status.key).length }}
                                </span>
                            </div>
                            
                            <!-- –ö–æ–ª–æ–Ω–∫–∞ -->
                            <div class="column-body flex-1 overflow-y-auto space-y-2 pr-1" :data-status="status.key">
                                <div v-for="cand in vacancyCandidatesByStatus(status.key)" 
                                     :key="cand.id" 
                                     :data-id="cand.id"
                                     class="bg-white p-3 rounded shadow-sm cursor-move hover:shadow-md border-l-4 transition relative group"
                                     :class="getScoreBorderColor(cand.ai_score)">
                                    
                                    <div class="flex justify-between items-start">
                                        <div class="font-bold text-sm text-gray-800">{{ cand.first_name }} {{ cand.last_name }}</div>
                                        <div class="text-xs font-bold" :class="getTextColor(cand.ai_score)">{{ cand.ai_score }}%</div>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1">@{{ cand.telegram_id }}</div>
                                    <div class="mt-2 text-xs text-gray-600 bg-gray-50 p-1.5 rounded italic line-clamp-2">
                                        {{ cand.ai_summary }}
                                    </div>
                                    <div class="mt-2 text-[10px] text-gray-400 text-right">
                                        {{ new Date(cand.created_at).toLocaleDateString() }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. –ö–ê–†–¢–û–ß–ö–ê –ö–ê–ù–î–ò–î–ê–¢–ê (–ù–û–í–û–ï) -->
        <div v-if="showCandidateCard" class="fixed inset-0 bg-black bg-opacity-50 z-50 overflow-auto flex justify-center items-start pt-5 pb-5">
            <div class="bg-white w-full max-w-5xl rounded-lg shadow-xl min-h-[80vh] flex flex-col">
                
                <!-- –®–∞–ø–∫–∞ -->
                <div class="p-6 border-b flex justify-between items-start bg-gray-50 rounded-t-lg">
                    <div class="flex gap-5">
                        <div class="w-20 h-20 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center text-white text-3xl font-bold shadow-md">
                            {{ candidateDetail.first_name[0] }}
                        </div>
                        <div>
                            <h2 class="text-3xl font-bold text-gray-800">{{ candidateDetail.first_name }} {{ candidateDetail.last_name }}</h2>
                            <p class="text-blue-600 font-medium mt-1">{{ candidateDetail.vacancy_title }}</p>
                            <div class="flex gap-2 mt-3">
                                <span class="px-3 py-1 rounded-full text-sm font-medium" :class="getStatusClass(candidateDetail.status)">
                                    {{ getStatusLabel(candidateDetail.status) }}
                                </span>
                                <span class="px-3 py-1 rounded-full text-sm font-medium bg-gray-200 text-gray-700">
                                    {{ candidateDetail.source === 'telegram' ? 'Telegram Bot' : '–†—É—á–Ω–æ–π –≤–≤–æ–¥' }}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-col items-end gap-4">
                        <button @click="closeCandidateCard" class="text-gray-400 hover:text-gray-700 text-3xl">&times;</button>
                        <div class="text-center">
                            <div class="text-3xl font-bold" :class="getTextColor(candidateDetail.ai_score)">{{ candidateDetail.ai_score }}%</div>
                            <div class="text-xs text-gray-500 uppercase">AI Score</div>
                        </div>
                    </div>
                </div>

                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç (2 –∫–æ–ª–æ–Ω–∫–∏) -->
                <div class="flex-1 grid grid-cols-1 lg:grid-cols-3">
                    
                    <!-- –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –ò–Ω—Ñ–æ –∏ –†–µ–∑—é–º–µ -->
                    <div class="lg:col-span-2 p-6 border-r space-y-6">
                        
                        <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
                        <div class="grid grid-cols-2 gap-4 bg-gray-50 p-4 rounded-lg">
                            <div>
                                <div class="text-xs text-gray-500">Email</div>
                                <a :href="'mailto:'+candidateDetail.email" class="text-blue-600 hover:underline">{{ candidateDetail.email }}</a>
                            </div>
                            <div>
                                <div class="text-xs text-gray-500">Telegram</div>
                                <div class="text-gray-800">@{{ candidateDetail.telegram_id || '-' }}</div>
                            </div>
                            <div>
                                <div class="text-xs text-gray-500">–î–∞—Ç–∞ –æ—Ç–∫–ª–∏–∫–∞</div>
                                <div class="text-gray-800">{{ new Date(candidateDetail.created_at).toLocaleDateString() }}</div>
                            </div>
                        </div>

                        <!-- AI –ê–Ω–∞–ª–∏–∑ -->
                        <div class="bg-blue-50 p-5 rounded-lg border border-blue-100">
                            <h3 class="font-bold text-blue-800 mb-2"><i class="fas fa-robot mr-2"></i>–ú–Ω–µ–Ω–∏–µ –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞</h3>
                            <p class="text-gray-700 leading-relaxed">{{ candidateDetail.ai_summary }}</p>
                        </div>

                        <!-- –†–µ–∑—é–º–µ -->
                        <div>
                            <h3 class="font-bold text-gray-800 mb-3 text-lg">üìÑ –¢–µ–∫—Å—Ç —Ä–µ–∑—é–º–µ</h3>
                            <div class="bg-gray-50 p-4 rounded-lg border text-sm text-gray-700 whitespace-pre-wrap font-mono max-h-96 overflow-y-auto">
                                {{ candidateDetail.resume_text }}
                            </div>
                        </div>
                    </div>

                    <!-- –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –î–µ–π—Å—Ç–≤–∏—è, –ö–æ–º–º–µ–Ω—Ç—ã, –ò—Å—Ç–æ—Ä–∏—è -->
                    <div class="p-6 bg-gray-50 space-y-6">
                        
                        <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
                        <div class="bg-white p-4 rounded-lg shadow-sm border">
                            <h3 class="font-bold text-gray-800 mb-3">–î–µ–π—Å—Ç–≤–∏—è</h3>
                            <div class="flex flex-col gap-2">
                                <button @click="changeStatusFromCard('interview')" v-if="candidateDetail.status === 'screening'" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600 transition">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –Ω–∞ –∏–Ω—Ç–µ—Ä–≤—å—é</button>
                                <button @click="changeStatusFromCard('offer')" v-if="candidateDetail.status === 'interview'" class="w-full bg-orange-500 text-white py-2 rounded hover:bg-orange-600 transition">–°–¥–µ–ª–∞—Ç—å –æ—Ñ—Ñ–µ—Ä</button>
                                <button @click="changeStatusFromCard('rejected')" v-if="candidateDetail.status !== 'rejected'" class="w-full bg-red-100 text-red-600 py-2 rounded hover:bg-red-200 transition">–û—Ç–∫–∞–∑–∞—Ç—å</button>
                            </div>
                        </div>

                        <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
                        <div class="bg-white p-4 rounded-lg shadow-sm border">
                            <h3 class="font-bold text-gray-800 mb-3">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
                            <div class="space-y-3 mb-4 max-h-60 overflow-y-auto">
                                <div v-for="comm in candidateDetail.comments" :key="comm.id" class="bg-gray-50 p-2 rounded text-sm">
                                    <div class="flex justify-between text-xs text-gray-500 mb-1">
                                        <span class="font-bold">{{ comm.author_name }}</span>
                                        <span>{{ new Date(comm.created_at).toLocaleDateString() }}</span>
                                    </div>
                                    <p>{{ comm.text }}</p>
                                </div>
                                <div v-if="candidateDetail.comments && candidateDetail.comments.length === 0" class="text-center text-gray-400 text-sm">–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>
                            </div>
                            <div class="flex gap-2">
                                <input v-model="newComment" @keyup.enter="addComment" type="text" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å –∑–∞–º–µ—Ç–∫—É..." class="flex-1 border rounded px-2 py-1 text-sm">
                                <button @click="addComment" class="bg-blue-600 text-white px-3 py-1 rounded text-sm"><i class="fas fa-paper-plane"></i></button>
                            </div>
                        </div>

                        <!-- –ò—Å—Ç–æ—Ä–∏—è -->
                        <div>
                            <h3 class="font-bold text-gray-500 text-xs uppercase mb-3">–ò—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h3>
                            <div class="space-y-4 border-l-2 border-gray-200 ml-2 pl-4">
                                <div v-for="act in candidateDetail.activities" :key="act.id" class="relative">
                                    <div class="absolute -left-[21px] top-1 w-3 h-3 bg-gray-300 rounded-full border-2 border-white"></div>
                                    <p class="text-sm text-gray-800">{{ act.description }}</p>
                                    <p class="text-xs text-gray-400">{{ new Date(act.created_at).toLocaleString() }}</p>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        const { createApp } = Vue

        createApp({
            data() {
                return {
                    currentTab: 'dashboard', // –ê–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞
                    apiUrl: 'http://127.0.0.1:8000',
                    vacancies: [],
                    candidates: [],
                    
                    // –ú–æ–¥–∞–ª–∫–∏
                    showModal: false,
                    showVacancyDetail: false,
                    loading: false,
                    
                    // –î–∞–Ω–Ω—ã–µ
                    newVacancy: { title: '', requirements: '' },
                    selectedVacancy: {},
                    vacancyCandidates: [],
                    
                    // –ö–∞–Ω–±–∞–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    statuses: [
                        { key: 'new', label: '–ù–æ–≤—ã–π', color: 'bg-blue-500' },
                        { key: 'screening', label: '–°–∫—Ä–∏–Ω–∏–Ω–≥', color: 'bg-purple-500' },
                        { key: 'interview', label: '–ò–Ω—Ç–µ—Ä–≤—å—é', color: 'bg-yellow-500' },
                        { key: 'offer', label: '–û—Ñ—Ñ–µ—Ä', color: 'bg-orange-500' },
                        { key: 'hired', label: '–ù–∞–Ω—è—Ç', color: 'bg-green-500' },
                        { key: 'rejected', label: '–û—Ç–∫–∞–∑', color: 'bg-red-500' }
                    ],

                    // –î–õ–Ø –¢–ê–ë–õ–ò–¶–´ –ö–ê–ù–î–ò–î–ê–¢–û–í
                    candidatesList: { items: [], total: 0, page: 1, pages: 1 },
                    candidatesStats: { total: 0, avg_score: 0 },
                    filters: { search: '', status: '', vacancy_id: '' },
                    searchTimeout: null,

                    // –î–õ–Ø –ö–ê–†–¢–û–ß–ö–ò –ö–ê–ù–î–ò–î–ê–¢–ê (–ù–û–í–û–ï)
                    showCandidateCard: false,
                    candidateDetail: { comments: [], activities: [], first_name: '' }, // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
                    newComment: '',
                }
            },
            methods: {
                async fetchData() {
                    try {
                        const resVac = await fetch(`${this.apiUrl}/vacancies/`);
                        this.vacancies = await resVac.json();
                    } catch (e) { console.error(e); }
                },
                async openVacancy(id) {
                    try {
                        const resDetail = await fetch(`${this.apiUrl}/vacancies/${id}`);
                        this.selectedVacancy = await resDetail.json();
                        const resCands = await fetch(`${this.apiUrl}/vacancies/${id}/candidates`);
                        this.vacancyCandidates = await resCands.json();
                        this.showVacancyDetail = true;
                        this.$nextTick(() => this.initSortable());
                    } catch (e) { alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"); }
                },
                closeVacancyDetail() {
                    this.showVacancyDetail = false;
                },
                vacancyCandidatesByStatus(status) {
                    return this.vacancyCandidates.filter(c => c.status === status);
                },
                initSortable() {
                    document.querySelectorAll('.column-body').forEach(col => {
                        new Sortable(col, {
                            group: 'kanban', animation: 150, ghostClass: 'opacity-50',
                            onEnd: (evt) => {
                                if (evt.from === evt.to) return;
                                this.updateStatus(evt.item.dataset.id, evt.to.dataset.status);
                            }
                        });
                    });
                },
                async updateStatus(id, newStatus) {
                    const cand = this.vacancyCandidates.find(c => c.id == id);
                    if (cand) cand.status = newStatus;
                    await fetch(`${this.apiUrl}/candidates/${id}`, {
                        method: 'PATCH',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ status: newStatus })
                    });
                },
                async createVacancy() {
                    if (!this.newVacancy.title) return;
                    this.loading = true;
                    try {
                        await fetch(`${this.apiUrl}/vacancies/generate`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ title: this.newVacancy.title, requirements: this.newVacancy.requirements, company_id: 1 })
                        });
                        this.showModal = false;
                        this.newVacancy = { title: '', requirements: '' };
                        this.fetchData();
                    } finally { this.loading = false; }
                },
                getScoreBorderColor(score) {
                    if (score >= 80) return 'border-green-500';
                    if (score >= 50) return 'border-yellow-400';
                    return 'border-red-500';
                },
                getTextColor(score) {
                    if (score >= 80) return 'text-green-600';
                    if (score >= 50) return 'text-yellow-600';
                    return 'text-red-600';
                },

                // --- –ú–ï–¢–û–î–´ –î–õ–Ø –ö–ê–ù–î–ò–î–ê–¢–û–í ---

                async loadCandidates() {
                    try {
                        const params = new URLSearchParams({
                            page: this.candidatesList.page,
                            per_page: 10,
                            search: this.filters.search,
                            status: this.filters.status,
                            vacancy_id: this.filters.vacancy_id
                        });
                        if (!this.filters.search) params.delete('search');
                        if (!this.filters.status) params.delete('status');
                        if (!this.filters.vacancy_id) params.delete('vacancy_id');

                        const res = await fetch(`${this.apiUrl}/candidates/search?${params}`);
                        const data = await res.json();
                        this.candidatesList = data;
                    } catch (e) { console.error(e); }
                },

                async loadCandidatesStats() {
                    try {
                        const res = await fetch(`${this.apiUrl}/candidates/stats`);
                        this.candidatesStats = await res.json();
                    } catch (e) { console.error(e); }
                },

                debouncedSearch() {
                    clearTimeout(this.searchTimeout);
                    this.searchTimeout = setTimeout(() => {
                        this.candidatesList.page = 1;
                        this.loadCandidates();
                    }, 500);
                },

                resetFilters() {
                    this.filters = { search: '', status: '', vacancy_id: '' };
                    this.loadCandidates();
                },

                goToPage(page) {
                    if (page >= 1 && page <= this.candidatesList.pages) {
                        this.candidatesList.page = page;
                        this.loadCandidates();
                    }
                },

                getStatusClass(status) {
                    const map = {
                        'new': 'bg-blue-100 text-blue-800',
                        'screening': 'bg-purple-100 text-purple-800',
                        'interview': 'bg-yellow-100 text-yellow-800',
                        'offer': 'bg-orange-100 text-orange-800',
                        'hired': 'bg-green-100 text-green-800',
                        'rejected': 'bg-red-100 text-red-800'
                    };
                    return map[status] || 'bg-gray-100';
                },
                getStatusLabel(status) {
                    const map = { 'new': '–ù–æ–≤—ã–π', 'screening': '–°–∫—Ä–∏–Ω–∏–Ω–≥', 'interview': '–ò–Ω—Ç–µ—Ä–≤—å—é', 'offer': '–û—Ñ—Ñ–µ—Ä', 'hired': '–ù–∞–Ω—è—Ç', 'rejected': '–û—Ç–∫–∞–∑' };
                    return map[status] || status;
                },
                getScoreBgColor(score) {
                    if (score >= 80) return 'bg-green-100 text-green-800 border-green-200';
                    if (score >= 50) return 'bg-yellow-100 text-yellow-800 border-yellow-200';
                    return 'bg-red-100 text-red-800 border-red-200';
                },
                
                exportCandidates() {
                    alert("–°–∫–∞—á–∏–≤–∞–Ω–∏–µ CSV —Ñ–∞–π–ª–∞...");
                },

                // --- –ú–ï–¢–û–î–´ –î–õ–Ø –ö–ê–†–¢–û–ß–ö–ò –ö–ê–ù–î–ò–î–ê–¢–ê (–ù–û–í–û–ï) ---

                async openCandidateCard(id) {
                    try {
                        const res = await fetch(`${this.apiUrl}/candidates/${id}/detail`);
                        if (!res.ok) throw new Error("Err");
                        this.candidateDetail = await res.json();
                        this.showCandidateCard = true;
                    } catch (e) { alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–æ—á–∫–∏"); }
                },

                closeCandidateCard() {
                    this.showCandidateCard = false;
                    this.candidateDetail = { comments: [], activities: [], first_name: '' }; // –û—á–∏—â–∞–µ–º
                },

                async addComment() {
                    if (!this.newComment.trim()) return;
                    try {
                        await fetch(`${this.apiUrl}/candidates/${this.candidateDetail.id}/comments`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ text: this.newComment })
                        });
                        this.newComment = '';
                        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
                        this.openCandidateCard(this.candidateDetail.id);
                    } catch (e) { alert("–û—à–∏–±–∫–∞"); }
                },

                async changeStatusFromCard(newStatus) {
                    await this.updateStatus(this.candidateDetail.id, newStatus);
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É
                    this.openCandidateCard(this.candidateDetail.id);
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É –Ω–∞ —Ñ–æ–Ω–µ
                    this.loadCandidates();
                }
            },
            mounted() {
                this.fetchData();
            }
        }).mount('#app')
    </script>
</body>
</html>